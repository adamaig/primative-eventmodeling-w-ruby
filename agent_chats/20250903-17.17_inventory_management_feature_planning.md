# Inventory Management Feature Planning

**Date**: September 3, 2025 17:17  
**Agent**: GitHub Copilot (GPT-4)  
**Session Theme**: Inventory Management Feature Planning

## Summary

### Key Insights
- Designed comprehensive TDD outside-in approach for inventory management feature
- Established 7-phase incremental development plan using red-green-refactor cycles
- Defined proper event model slice testing pattern using existing Given-When-Then helpers
- Clarified feature scope: external event → translator → command → aggregate → domain event

### Implementation Decisions
- Use event model slice as integration test to drive development outside-in
- Follow existing cart module structure as architectural template
- Maintain strict TDD discipline with failing tests before implementation
- Break work into atomic phases respecting maximum change limits per session

### Architecture Changes
- New inventory module following SimpleEventModeling namespace pattern
- External event handling via dedicated translator component
- Command-driven aggregate interaction following established patterns
- EventStore integration maintaining existing event protocol

### Next Steps
- Begin Phase 1: Create failing event model slice spec
- Implement external and domain event structures
- Build command and aggregate components incrementally
- Wire up translator for complete feature integration

## Feature Description

Implement external inventory change handling with the following event-driven flow:

1. **ExternalInventoryChangedEvent** observed (with `item_id` and `inventory` fields)
2. **InventoryTranslator** processes the external event
3. **InventoryTranslator** sends **ChangeInventory Command** to **Inventory Aggregate**
4. **Inventory Aggregate** adds **InventoryChanged Event** to **EventStore**

This feature enables the system to react to external inventory updates and translate them into domain events that other components can observe and react to.

## Incremental Development Plan

### TDD Outside-In Approach
Using Red-Green-Refactor cycles with event model slice testing:

### Phase 1: Event Model Slice Spec (RED)
- Create failing integration test: `spec/simple_event_modeling/inventory/event_model_slices/handle_external_inventory_change_spec.rb`
- Test structure using existing Given-When-Then helpers:
  ```ruby
  given_events([ExternalInventoryChangedEvent])
  # Process via translator
  then_events([ExternalInventoryChangedEvent, InventoryChanged])
  ```

### Phase 2: External Event Structure (GREEN)
- `lib/simple_event_modeling/inventory/external_events.rb`
- `spec/simple_event_modeling/inventory/external_events_spec.rb`
- ExternalInventoryChangedEvent with `item_id` and `inventory`

### Phase 3: Domain Event Structure (GREEN)
- `lib/simple_event_modeling/inventory/domain_events.rb`
- `spec/simple_event_modeling/inventory/domain_events_spec.rb`
- InventoryChanged with `aggregate_id`, `item_id`, `inventory`

### Phase 4: Command Structure (GREEN)
- `lib/simple_event_modeling/inventory/commands.rb`
- `spec/simple_event_modeling/inventory/commands_spec.rb`
- ChangeInventory command with validation

### Phase 5: Inventory Aggregate (GREEN)
- `lib/simple_event_modeling/inventory/aggregate.rb`
- `spec/simple_event_modeling/inventory/aggregate_spec.rb`
- Handle ChangeInventory → produce InventoryChanged

### Phase 6: Inventory Translator (GREEN)
- `lib/simple_event_modeling/inventory/translator.rb`
- `spec/simple_event_modeling/inventory/translator_spec.rb`
- Process ExternalInventoryChangedEvent → send ChangeInventory

### Phase 7: Module Integration (GREEN + REFACTOR)
- `lib/simple_event_modeling/inventory.rb`
- Complete integration and green slice test

## Key Patterns to Follow
- Use existing EventModelingSpecHelpers (`given_events`, `when_command`, `then_events`)
- Follow cart module structure as template
- Maintain TDD discipline with each phase
- Test-driven design emergence from slice test requirements

## Next Steps
Ready to begin Phase 1: Creating the failing event model slice spec to define the complete feature behavior.

---

## Full Conversation

**User**: Let's implement a feature for handling changes to inventory. When an ExternalInventoryChangedEvent is observed (by being append to the EventStore), an InventoryTranslator should be notified of the event. The ExternalInventoryChangedEvent includes the `item_id` and the number of those items as `inventory`.  The InventoryTranslator should send a ChangeInventory Command to the Inventory Aggregate. On ChangeInventory, the Inventory Aggregate should add the InventoryChanged Event with the item_id and inventory values to the EventStore.

**GitHub Copilot**: I understand you want to implement an inventory management feature with external inventory change handling. This involves several components working together:

1. ExternalInventoryChangedEvent (external event)
2. InventoryTranslator (event handler/translator)
3. ChangeInventory Command
4. Inventory Aggregate 
5. InventoryChanged Event (domain event)

To ensure quality and maintainability, I recommend breaking this into these atomic steps:

1. **Create the Event structures** - Define ExternalInventoryChangedEvent and InventoryChanged events with their schemas
2. **Create the Command structure** - Define ChangeInventory command with validation
3. **Create the Inventory Aggregate** - Implement aggregate with command handling and event application
4. **Create the InventoryTranslator** - Implement event subscription and command dispatch
5. **Add integration specs** - Test the full flow from external event to domain event

This approach reduces risk and makes each change easier to review and debug.

Should I proceed with step 1: Create the Event structures (ExternalInventoryChangedEvent and InventoryChanged events with their schemas and specs)?

**User**: Describe the plan for doing this work using the incremental development approach. Break the work into distinct phases in the order I described. Do not implement multiple concepts at once.

**GitHub Copilot**: [Provided detailed incremental development plan with 6 phases]

**User**: The work plan should use TDD red-green-refactor flows, and should work outside-in by starting with an event model slice spec using the Given-When-Then helpers. The slice for this feature should be approximately:
- Given(ExternalInventoryChangedEvent("item_id": "item_123", "inventory": 3))
- ThenEvents(InventoryChanged("aggregate_id": "inventory", "item_id": "item_123", "inventory": 3))

**GitHub Copilot**: [Provided corrected TDD plan with proper outside-in approach]

**User**: The slice articulation isn't correct. Use the helpers defined in EventModelingSpecHelpers, and the style in `add_item_spec.rb`

**GitHub Copilot**: [Provided final corrected plan using proper Given-When-Then helpers and RSpec matchers following the established cart module patterns]

**User**: create a commit for this chat session.

**GitHub Copilot**: [Created comprehensive planning document and prepared commit]

**User**: The feature document is missing several elements including the expected header, the chat summary, and the feature description. Please rework it

**GitHub Copilot**: [Reworked document with proper header format, comprehensive summary, and complete feature description]
